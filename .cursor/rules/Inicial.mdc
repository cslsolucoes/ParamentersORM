# üìö Parameters vers√£o 1.0.0 - Regras de Desenvolvimento

**Vers√£o:** 1.0.0  
**Data de Cria√ß√£o:** 01/01/2026  
**Data de Atualiza√ß√£o:** 02/01/2026  
**Status:** ‚úÖ ~99% COMPLETO

---

## üéØ OBJETIVO PRINCIPAL

Gerar um sistema de parametriza√ß√£o que far√° parte de v√°rios sistemas.

**Nome do Projeto:** Parameters vers√£o 1.0.0

**Regra Fundamental:** O sistema s√≥ ter√° de arquivos externos os arquivos abaixo:

- `Parameters.pas`
- `Parameters.Intefaces.pas`

---

## üèóÔ∏è ARQUITETURA E ENCAPSULAMENTO

### Estrutura de Arquivos

```
üìÅ src/Modulo/

‚úÖ ARQUIVOS P√öBLICOS (2 - Acess√≠veis externamente):
‚îú‚îÄ‚îÄ Parameters.pas              ‚Üí Ponto de Entrada (Factory methods + TParametersImpl) [‚úÖ 1.271 linhas]
‚îî‚îÄ‚îÄ Parameters.Intefaces.pas    ‚Üí Interfaces P√∫blicas [‚úÖ 306 linhas]
    ‚îî‚îÄ‚îÄ‚Üí IParameters (interface principal de converg√™ncia)
    ‚îî‚îÄ‚îÄ‚Üí IParametersDatabase
    ‚îî‚îÄ‚îÄ‚Üí IParametersInifiles
    ‚îî‚îÄ‚îÄ‚Üí IParametersJsonObject
    ‚îî‚îÄ‚îÄ‚Üí Re-exporta tipos p√∫blicos (TParameter, TParameterList, etc.)

üîí ARQUIVOS INTERNOS (6 - Apenas na se√ß√£o implementation):
‚îú‚îÄ‚îÄ Parameters.Database.pas    ‚Üí TParametersDatabase [‚úÖ 4.912 linhas]
‚îú‚îÄ‚îÄ Parameters.Inifiles.pas    ‚Üí TParametersInifiles [‚úÖ 1.476 linhas]
‚îú‚îÄ‚îÄ Parameters.JsonObject.pas  ‚Üí TParametersJsonObject [‚úÖ 2.264 linhas]
‚îú‚îÄ‚îÄ Parameters.Types.pas        ‚Üí Tipos (re-exportados via Interfaces) [‚úÖ 374 linhas]
‚îú‚îÄ‚îÄ Parameters.Consts.pas       ‚Üí Constantes [‚úÖ 497 linhas]
‚îî‚îÄ‚îÄ Parameters.Exceptions.pas   ‚Üí Exce√ß√µes customizadas [‚úÖ 567 linhas]
```

### Princ√≠pios de Encapsulamento

1. **Apenas 2 arquivos p√∫blicos:** `Parameters.pas` e `Parameters.Intefaces.pas`
2. **Todas as implementa√ß√µes** ficam na se√ß√£o `implementation` e n√£o s√£o acess√≠veis diretamente
3. **Tipos e constantes** s√£o re-exportados via `Parameters.Intefaces.pas`
4. **C√≥digo externo** n√£o consegue acessar implementa√ß√µes diretamente (apenas via interfaces p√∫blicas)

### Fluxo de Dados

```
Aplica√ß√£o
    ‚Üì
Parameters (IParameters)
    ‚Üì
    ‚îú‚îÄ‚îÄ‚Üí IParametersDatabase (Banco de Dados)
    ‚îú‚îÄ‚îÄ‚Üí IParametersInifiles (Arquivos INI)
    ‚îî‚îÄ‚îÄ‚Üí IParametersJsonObject (JSON Objects)
```

---

## üì¶ FUNCIONALIDADES PRINCIPAIS

### Caracter√≠sticas Implementadas

- ‚úÖ **Multi-fonte:** Suporte a Database, INI Files e JSON Objects
- ‚úÖ **Fallback Autom√°tico:** Busca em cascata quando uma fonte falha
- ‚úÖ **Multi-engine Database:** UNIDAC, FireDAC, Zeos
- ‚úÖ **Multi-database:** PostgreSQL, MySQL, SQL Server, SQLite, FireBird, Access, ODBC
- ‚úÖ **Thread-safe:** Todas as opera√ß√µes protegidas com TCriticalSection (100% dos m√≥dulos)
- ‚úÖ **Fluent Interface:** M√©todos encade√°veis para c√≥digo mais leg√≠vel
- ‚úÖ **Importa√ß√£o/Exporta√ß√£o:** Bidirecional entre todas as fontes
- ‚úÖ **L√≥gica de Ordem Autom√°tica:** Implementada em Database, INI e JSON
- ‚úÖ **Sistema de Exce√ß√µes Completo:** 8 tipos, 90+ c√≥digos de erro

### Thread-Safety Completo

**Status:** ‚úÖ **100% IMPLEMENTADO**

Todos os 4 m√≥dulos implementam thread-safety:
- ‚úÖ **TParametersImpl** - TCriticalSection em todos os m√©todos
- ‚úÖ **TParametersInifiles** - TCriticalSection em todos os m√©todos
- ‚úÖ **TParametersJsonObject** - TCriticalSection em todos os m√©todos
- ‚úÖ **TParametersDatabase** - TCriticalSection em 14 m√©todos principais

**M√©todos Protegidos (Database):**
- CRUD: `List`, `Get`, `Insert`, `Update`, `Delete`, `Exists`, `Count`
- Conex√£o: `Connect`, `Disconnect`, `Refresh`
- Tabela: `CreateTable`, `DropTable`
- Configura√ß√£o: `Database`, `Connection`

---

## üîß REGRAS DE DESENVOLVIMENTO

### 1. Factory Pattern

**Sempre use Factory Methods para criar inst√¢ncias:**

```pascal
// ‚úÖ CORRETO
var Parameters: IParameters;
Parameters := TParameters.New([pcfDataBase, pcfInifile]);

var DB: IParametersDatabase;
DB := TParameters.NewDatabase;

// ‚ùå ERRADO - N√£o acesse implementa√ß√µes diretamente
var Impl: TParametersImpl; // N√£o √© acess√≠vel externamente!
```

### 2. Fluent Interface

**Todos os m√©todos de configura√ß√£o devem retornar a pr√≥pria interface:**

```pascal
// ‚úÖ CORRETO - M√©todos encade√°veis
DB.Host('localhost')
  .Port(5432)
  .Database('mydb')
  .Connect;

// ‚ùå ERRADO - N√£o retorna interface
procedure SetHost(const AValue: string); // N√£o permite encadeamento
```

### 3. Thread-Safety

**Todas as opera√ß√µes devem ser protegidas com TCriticalSection:**

```pascal
// ‚úÖ CORRETO
FLock.Enter;
try
  // Opera√ß√£o thread-safe
finally
  FLock.Leave;
end;
```

### 4. Tratamento de Erros

**Sempre use exce√ß√µes espec√≠ficas do m√≥dulo:**

```pascal
// ‚úÖ CORRETO
raise CreateConnectionException('Falha ao conectar', ERROR_CONNECTION_FAILED, 'Connect');

// ‚ùå ERRADO
raise Exception.Create('Erro'); // N√£o fornece contexto suficiente
```

### 5. Valida√ß√£o de Entrada

**Sempre valide par√¢metros antes de processar:**

```pascal
// ‚úÖ CORRETO
if AName = '' then
  raise CreateValidationException('Nome do par√¢metro n√£o pode ser vazio', ERROR_VALIDATION_EMPTY_NAME, 'Get');
```

### 6. Fallback Autom√°tico

**Implementa√ß√µes devem suportar fallback quando uma fonte falha:**

```pascal
// ‚úÖ CORRETO - Tenta Database, depois INI, depois JSON
function TParametersImpl.Get(const AName: string): TParameter;
var
  I: Integer;
begin
  Result := nil;
  for I := 0 to High(FPriority) do
  begin
    if TryGetFromSource(AName, FPriority[I], Result) then
      Exit;
  end;
end;
```

### 7. L√≥gica de Ordem Autom√°tica

**Sempre ajuste ordens automaticamente ao inserir/atualizar:**

```pascal
// ‚úÖ CORRETO
if AParameter.Ordem = 0 then
  AParameter.Ordem := GetNextOrder(AParameter.Titulo, AParameter.ContratoID, AParameter.ProdutoID)
else
  AdjustOrdersForInsert(AParameter.Titulo, AParameter.ContratoID, AParameter.ProdutoID, AParameter.Ordem);
```

### 8. Preserva√ß√£o de Dados

**Preserve coment√°rios e formata√ß√£o em arquivos INI:**

```pascal
// ‚úÖ CORRETO - L√™ linha por linha preservando coment√°rios
function ReadIniFileLines: TStringList;
begin
  Result := TStringList.Create;
  Result.LoadFromFile(FFilePath);
  // Preserva todas as linhas, incluindo coment√°rios
end;
```

### 9. Detec√ß√£o de Encoding

**Detecte e converta encoding em arquivos JSON:**

```pascal
// ‚úÖ CORRETO - Detecta UTF-8, UTF-16, ANSI
function LoadFromFile(const AFilePath: string): IParametersJsonObject;
var
  Encoding: TEncoding;
  Content: string;
begin
  Encoding := DetectEncoding(AFilePath);
  Content := TFile.ReadAllText(AFilePath, Encoding);
  // Converte para UTF-8 se necess√°rio
end;
```

### 10. Importa√ß√£o/Exporta√ß√£o Bidirecional

**Suporte importa√ß√£o/exporta√ß√£o entre todas as fontes:**

```pascal
// ‚úÖ CORRETO
Ini.ImportFromDatabase(DB);      // INI ‚Üê Database
Json.ImportFromInifiles(Ini);     // JSON ‚Üê INI
DB.ExportFromJsonObject(Json);    // Database ‚Üê JSON
```

---

## üìã INTERFACES E M√âTODOS

### IParameters (Interface Principal de Converg√™ncia)

**Gerenciamento de Fontes:**
- `Source(ASource)` / `Source` - Define/retorna fonte ativa
- `AddSource(ASource)` - Adiciona fonte √† lista
- `RemoveSource(ASource)` - Remove fonte da lista
- `HasSource(ASource)` - Verifica se fonte est√° ativa
- `Priority(ASources)` - Define ordem de prioridade

**Opera√ß√µes Unificadas (com Fallback):**
- `Get(AName)` - Busca em cascata (Database ‚Üí INI ‚Üí JSON)
- `Get(AName, ASource)` - Busca em fonte espec√≠fica
- `List()` - Merge de todas as fontes (remove duplicatas)
- `Insert(AParameter)` - Insere na fonte ativa
- `Update(AParameter)` - Atualiza na fonte onde existe
- `Delete(AName)` - Deleta de todas as fontes onde existe
- `Exists(AName)` - Verifica em todas as fontes (OR l√≥gico)
- `Count()` - Conta par√¢metros √∫nicos
- `Refresh()` - Refresh em todas as fontes ativas

**Configura√ß√£o Unificada:**
- `ContratoID(Value)` / `ContratoID` - Aplica em todas as fontes
- `ProdutoID(Value)` / `ProdutoID` - Aplica em todas as fontes

**Acesso Direto a Fontes:**
- `Database()` - Retorna IParametersDatabase
- `Inifiles()` - Retorna IParametersInifiles
- `JsonObject()` - Retorna IParametersJsonObject

### IParametersDatabase

**Configura√ß√£o de Conex√£o:**
- `Engine(Value)` / `Engine` - Define engine (UniDAC, FireDAC, Zeos)
- `DatabaseType(Value)` / `DatabaseType` - Define tipo de banco
- `Host(Value)` / `Host` - Define host
- `Port(Value)` / `Port` - Define porta
- `Username(Value)` / `Username` - Define usu√°rio
- `Password(Value)` / `Password` - Define senha
- `Database(Value)` / `Database` - Define nome do banco
- `TableName(Value)` / `TableName` - Define nome da tabela
- `Schema(Value)` / `Schema` - Define schema
- `AutoCreateTable(Value)` / `AutoCreateTable` - Auto-criar tabela

**CRUD:**
- `List()` - Lista todos os par√¢metros ativos
- `Get(AName)` - Busca par√¢metro por chave
- `Insert(AParameter)` - Insere novo par√¢metro
- `Update(AParameter)` - Atualiza par√¢metro existente
- `Delete(AName)` - Soft delete (marca como inativo)
- `Exists(AName)` - Verifica se par√¢metro existe
- `Count()` - Conta par√¢metros ativos

**Conex√£o:**
- `Connect()` - Conecta ao banco
- `Disconnect()` - Desconecta do banco
- `IsConnected()` - Verifica se est√° conectado

**Gerenciamento de Tabela:**
- `TableExists()` - Verifica se tabela existe
- `CreateTable()` - Cria tabela com estrutura padr√£o
- `DropTable()` - Remove tabela

### IParametersInifiles

**Configura√ß√£o:**
- `FilePath(Value)` / `FilePath` - Define caminho do arquivo INI
- `Section(Value)` / `Section` - Define se√ß√£o (t√≠tulo)
- `AutoCreateFile(Value)` / `AutoCreateFile` - Auto-criar arquivo
- `ContratoID(Value)` / `ContratoID` - Define filtro
- `ProdutoID(Value)` / `ProdutoID` - Define filtro

**CRUD:** (mesmos m√©todos de IParametersDatabase)

**Utilit√°rios:**
- `FileExists()` - Verifica se arquivo existe
- `Refresh()` - Recarrega arquivo

**Importa√ß√£o/Exporta√ß√£o:**
- `ImportFromDatabase(ADatabase)` - Importa de Database
- `ExportToDatabase(ADatabase)` - Exporta para Database

### IParametersJsonObject

**Configura√ß√£o:**
- `JsonObject(AJsonObject)` / `JsonObject` - Define objeto JSON
- `ObjectName(Value)` / `ObjectName` - Define nome do objeto (t√≠tulo)
- `FilePath(Value)` / `FilePath` - Define caminho do arquivo JSON
- `AutoCreateFile(Value)` / `AutoCreateFile` - Auto-criar arquivo
- `ContratoID(Value)` / `ContratoID` - Define filtro
- `ProdutoID(Value)` / `ProdutoID` - Define filtro

**CRUD:** (mesmos m√©todos de IParametersDatabase)

**Utilit√°rios:**
- `FileExists()` - Verifica se arquivo existe
- `Refresh()` - Recarrega arquivo
- `ToJSON()` - Retorna objeto JSON completo
- `ToJSONString()` - Retorna JSON como string formatada
- `SaveToFile(AFilePath)` - Salva JSON em arquivo
- `LoadFromFile(AFilePath)` - Carrega JSON de arquivo
- `LoadFromString(AJsonString)` - Carrega JSON de string

**Importa√ß√£o/Exporta√ß√£o:**
- `ImportFromDatabase(ADatabase)` - Importa de Database
- `ExportToDatabase(ADatabase)` - Exporta para Database
- `ImportFromInifiles(AInifiles)` - Importa de INI
- `ExportToInifiles(AInifiles)` - Exporta para INI

---

## üõ°Ô∏è TRATAMENTO DE ERROS

### Sistema de Exce√ß√µes

**8 tipos de exce√ß√µes espec√≠ficas:**
1. `EParametersException` (base)
2. `EParametersConnectionException` (erros de conex√£o)
3. `EParametersSQLException` (erros de SQL)
4. `EParametersValidationException` (erros de valida√ß√£o)
5. `EParametersNotFoundException` (par√¢metro n√£o encontrado)
6. `EParametersConfigurationException` (erros de configura√ß√£o)
7. `EParametersFileException` (erros de arquivo)
8. `EParametersInifilesException` (erros de INI)
9. `EParametersJsonObjectException` (erros de JSON)

**90+ c√≥digos de erro organizados por faixa:**
- Conex√£o (1000-1099): 10 c√≥digos
- SQL (1100-1199): 16 c√≥digos
- Valida√ß√£o (1200-1299): 12 c√≥digos
- Opera√ß√£o (1300-1399): 11 c√≥digos
- Configura√ß√£o (1400-1499): 9 c√≥digos
- Arquivo (1500-1599): 13 c√≥digos
- INI (1600-1699): 8 c√≥digos
- JSON (1700-1799): 12 c√≥digos
- Importa√ß√£o/Exporta√ß√£o (1800-1899): 9 c√≥digos

**Sempre use fun√ß√µes auxiliares para criar exce√ß√µes:**

```pascal
// ‚úÖ CORRETO
raise CreateConnectionException('Falha ao conectar', ERROR_CONNECTION_FAILED, 'Connect');

// ‚ùå ERRADO
raise Exception.Create('Erro'); // N√£o fornece contexto suficiente
```

---

## üìä TIPOS E ESTRUTURAS

### TParameter

Classe que representa um par√¢metro de configura√ß√£o:

```pascal
TParameter = class
public
  ID: Integer;                    // ID √∫nico (Database)
  Name: string;                   // Nome/chave do par√¢metro
  Value: string;                  // Valor do par√¢metro
  ValueType: TParameterValueType; // Tipo do valor
  Description: string;            // Descri√ß√£o/coment√°rio
  ContratoID: Integer;            // Filtro de contrato
  ProdutoID: Integer;            // Filtro de produto
  Ordem: Integer;                // Ordem de exibi√ß√£o
  Titulo: string;                 // T√≠tulo/se√ß√£o/objeto
  Ativo: Boolean;                // Status ativo/inativo
  CreatedAt: TDateTime;           // Data de cria√ß√£o
  UpdatedAt: TDateTime;          // Data de atualiza√ß√£o
end;
```

### TParameterList

Lista gerenciada de par√¢metros:

```pascal
TParameterList = class(TList<TParameter>)
public
  procedure ClearAll; // Libera todos os objetos e limpa lista
end;
```

### Enums

- `TParameterValueType` - Tipos de valor (String, Integer, Float, Boolean, DateTime, JSON)
- `TParameterSource` - Fontes de dados (Database, Inifiles, JsonObject)
- `TParameterDatabaseEngine` - Engines (UniDAC, FireDAC, Zeos)
- `TParameterDatabaseTypes` - Tipos de banco (PostgreSQL, MySQL, SQL Server, SQLite, FireBird, Access, ODBC)
- `TParameterConfigOption` - Op√ß√µes de configura√ß√£o (pcfDataBase, pcfInifile, pcfJsonObject)
- `TParameterConfig` - Set de op√ß√µes (`set of TParameterConfigOption`)

---

## ‚úÖ CHECKLIST DE DESENVOLVIMENTO

### Ao Criar/Modificar M√©todos:

- [ ] M√©todo retorna interface para fluent interface?
- [ ] Opera√ß√£o √© thread-safe (TCriticalSection)?
- [ ] Par√¢metros s√£o validados?
- [ ] Exce√ß√µes espec√≠ficas s√£o usadas?
- [ ] Ordem √© ajustada automaticamente (se aplic√°vel)?
- [ ] Fallback √© implementado (se aplic√°vel)?
- [ ] Coment√°rios e formata√ß√£o s√£o preservados (INI)?
- [ ] Encoding √© detectado e convertido (JSON)?
- [ ] M√©todo tem overloads com `out` para fluent interface?
- [ ] M√©todo tem vers√£o com retorno de sucesso (`out ASuccess`)?

### Ao Criar/Modificar Classes:

- [ ] Classe est√° na se√ß√£o `implementation` (se for implementa√ß√£o)?
- [ ] Interface p√∫blica est√° definida em `Parameters.Intefaces.pas`?
- [ ] Factory method est√° em `Parameters.pas`?
- [ ] Thread-safety est√° implementado?
- [ ] Tratamento de erros est√° completo?

### Ao Criar/Modificar Tipos:

- [ ] Tipo est√° em `Parameters.Types.pas`?
- [ ] Tipo √© re-exportado via `Parameters.Intefaces.pas`?
- [ ] Tipo tem documenta√ß√£o adequada?

---

## üìö DOCUMENTA√á√ÉO

### Arquivos de Documenta√ß√£o

- `README.md` - Documenta√ß√£o completa unit por unit
- `Analises/ROADMAP_MODULO_PARAMETERS.html` - Roadmap completo
- `Analises/ARQUITETURA_MODULO_PARAMETERS.html` - Arquitetura detalhada
- `Analises/HISTORICO_COMPLETO_MODULO_PARAMETERS.html` - Hist√≥rico de desenvolvimento

### Coment√°rios no C√≥digo

**Sempre adicione coment√°rios detalhados:**
- Finalidade do m√©todo
- Par√¢metros e retorno
- Exemplos de uso
- Exce√ß√µes que podem ser lan√ßadas

---

## üéØ STATUS DO PROJETO

### Fases Conclu√≠das (‚úÖ)

- ‚úÖ **Fase 1:** Estrutura Base e Tipos (100%)
- ‚úÖ **Fase 2:** Implementa√ß√£o Database (100%)
- ‚úÖ **Fase 3:** Implementa√ß√£o Inifiles (100%)
- ‚úÖ **Fase 4:** Implementa√ß√£o JsonObject (100%)
- ‚úÖ **Fase 5:** M√≥dulo Principal - Converg√™ncia (100%)
- ‚úÖ **Fase 7:** Documenta√ß√£o Completa (100%)

### Fases em Progresso (üü°)

- üü° **Fase 6:** Testes e Valida√ß√£o (~80%)

### Estat√≠sticas

- **Arquivos Implementados:** 8 units
- **Linhas de C√≥digo:** ~11.000 linhas
- **Progresso Geral:** ~99%
- **Thread-Safety:** ‚úÖ 100% (4 de 4 m√≥dulos)
- **Status:** ‚úÖ Pronto para uso em produ√ß√£o (multithread)

---

## üöÄ PR√ìXIMOS PASSOS

1. **Testes Unit√°rios Completos**
   - Testes de Database (m√∫ltiplas tabelas, m√∫ltiplos engines)
   - Testes de Inifiles (m√∫ltiplas se√ß√µes)
   - Testes de JsonObject (m√∫ltiplos objetos)
   - Testes de converg√™ncia (fallback autom√°tico)
   - Testes de thread-safety

2. **Testes de Integra√ß√£o**
   - Testes com Providers.DataModule
   - Testes com m√∫ltiplos engines simultaneamente
   - Testes de performance

---

**Autor:** Claiton de Souza Linhares  
**Data de Cria√ß√£o:** 01/01/2026  
**√öltima Atualiza√ß√£o:** 02/01/2026  
**Vers√£o:** 1.0.0
